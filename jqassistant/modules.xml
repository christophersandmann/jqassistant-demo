<jqa:jqassistant-rules xmlns:jqa="http://www.buschmais.com/jqassistant/core/analysis/rules/schema/v1.0">

    <concept id="modules:DataImport">
        <description>Labels the package "com.buschmais.workshop.dataimport" as "Module" and "DataImport".</description>
        <cypher><![CDATA[
          MATCH
            (m:Package)
          WHERE
			m.fqn="com.buschmais.workshop.dataimport"
	      SET
	        m:Module:DataImport
          RETURN
            m.fqn as Module
        ]]></cypher>
    </concept>

    <concept id="modules:ShoppingCart">
        <description>Labels the package "com.buschmais.workshop.shoppingcart" as "Module" and "ShoppingCart".</description>
        <cypher><![CDATA[
          MATCH
            (m:Package)
          WHERE
			m.fqn="com.buschmais.workshop.shoppingcart"
	      SET
	        m:Module:ShoppingCart
          RETURN
            m.fqn as Module
        ]]></cypher>
    </concept>

    <concept id="modules:UserManagement">
        <description>Labels the package "com.buschmais.workshop.usermanagement" as "Module" and "UserManagement".</description>
        <cypher><![CDATA[
          MATCH
            (m:Package)
          WHERE
			m.fqn="com.buschmais.workshop.usermanagement"
	      SET
	        m:Module:UserManagement
          RETURN
            m.fqn as Module
        ]]></cypher>
    </concept>

    <concept id="modules:DefinedModules">
        <requiresConcept refId="modules:DataImport" />
        <requiresConcept refId="modules:UserManagement" />
        <requiresConcept refId="modules:ShoppingCart" />
        <description>Returns all defined modules.</description>
        <cypher><![CDATA[
          MATCH
            (m:Package:Module)
          RETURN
            m.fqn as Module
        ]]></cypher>
    </concept>

    <constraint id="modules:UndefinedModules">
        <requiresConcept refId="modules:DefinedModules" />
        <description>All direct sub-packages of "com.buschmais.workshop" must be defined as modules.</description>
        <cypher><![CDATA[
          MATCH
            (root:Package)-[:CONTAINS]->(m:Package)
          WHERE
            root.fqn="com.buschmais.workshop"
            AND NOT (
              m:Module
            )
          RETURN
            m.fqn as UndefinedModule
        ]]></cypher>
    </constraint>

    <constraint id="modules:ShoppingCartDependencies">
        <requiresConcept refId="modules:DefinedModules" />
        <requiresConcept refId="dependency:Type" />
        <description>All types in shopping cart module must only have dependencies to the user module.</description>
        <cypher><![CDATA[
          MATCH
            (m1:Package:Module)-[:CONTAINS*0..]->(type1:Type),
            (m2:Package:Module)-[:CONTAINS*0..]->(type2:Type),
            (type1)-[:DEPENDS_ON]->(type2)
          WHERE
            m1<>m2 AND
            m1:ShoppingCart
            AND NOT (
              m2:UserManagement
          )
          RETURN
            type1.fqn as Dependent, m2.fqn as InvalidModuleDependency, type2.fqn as InvalidTypeDependency
		]]></cypher>
    </constraint>

</jqa:jqassistant-rules>